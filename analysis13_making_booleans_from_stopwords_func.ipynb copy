{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {
    "collapsed": true
   },
   "outputs": [],
   "source": [
    "from utils.helpers_string_normalizer import normalize, POST_NORMALIZATION_STOP_WORDS_FOR_VENDOR_NAME\n",
    "import pandas as pd"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {
    "collapsed": false
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>budget_id</th>\n",
       "      <th>budget_price</th>\n",
       "      <th>actual_cost</th>\n",
       "      <th>purchase_vendor</th>\n",
       "      <th>travel_vendor</th>\n",
       "      <th>budget_type</th>\n",
       "      <th>budget_saver_scenario_id</th>\n",
       "      <th>end_datetime</th>\n",
       "      <th>start_datetime</th>\n",
       "      <th>budget_price_source</th>\n",
       "      <th>...</th>\n",
       "      <th>expense_type_name_itemization</th>\n",
       "      <th>transaction_date_itemization</th>\n",
       "      <th>vendor_name_expense</th>\n",
       "      <th>organization_id_expense</th>\n",
       "      <th>expense_system_expense</th>\n",
       "      <th>expensed_amount_itemization</th>\n",
       "      <th>expensed_amount_expense</th>\n",
       "      <th>expense_category_itemization</th>\n",
       "      <th>expense_category_expense</th>\n",
       "      <th>label</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>123180.0</td>\n",
       "      <td>950.0</td>\n",
       "      <td>843.93</td>\n",
       "      <td>American Express Global Business Travel</td>\n",
       "      <td>YOTEL New York City</td>\n",
       "      <td>hotel</td>\n",
       "      <td>13.0</td>\n",
       "      <td>2016-07-13 04:00:00</td>\n",
       "      <td>2016-07-10 04:00:00</td>\n",
       "      <td>942.0</td>\n",
       "      <td>...</td>\n",
       "      <td>Hotel</td>\n",
       "      <td>2016-07-12</td>\n",
       "      <td>YL</td>\n",
       "      <td>177</td>\n",
       "      <td>concur</td>\n",
       "      <td>242.10</td>\n",
       "      <td>843.93</td>\n",
       "      <td>other</td>\n",
       "      <td>other</td>\n",
       "      <td>positive</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>123180.0</td>\n",
       "      <td>950.0</td>\n",
       "      <td>843.93</td>\n",
       "      <td>American Express Global Business Travel</td>\n",
       "      <td>YOTEL New York City</td>\n",
       "      <td>hotel</td>\n",
       "      <td>13.0</td>\n",
       "      <td>2016-07-13 04:00:00</td>\n",
       "      <td>2016-07-10 04:00:00</td>\n",
       "      <td>942.0</td>\n",
       "      <td>...</td>\n",
       "      <td>Hotel</td>\n",
       "      <td>2016-07-11</td>\n",
       "      <td>YL</td>\n",
       "      <td>177</td>\n",
       "      <td>concur</td>\n",
       "      <td>242.10</td>\n",
       "      <td>843.93</td>\n",
       "      <td>other</td>\n",
       "      <td>other</td>\n",
       "      <td>positive</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>123180.0</td>\n",
       "      <td>950.0</td>\n",
       "      <td>843.93</td>\n",
       "      <td>American Express Global Business Travel</td>\n",
       "      <td>YOTEL New York City</td>\n",
       "      <td>hotel</td>\n",
       "      <td>13.0</td>\n",
       "      <td>2016-07-13 04:00:00</td>\n",
       "      <td>2016-07-10 04:00:00</td>\n",
       "      <td>942.0</td>\n",
       "      <td>...</td>\n",
       "      <td>Hotel Tax</td>\n",
       "      <td>2016-07-12</td>\n",
       "      <td>YL</td>\n",
       "      <td>177</td>\n",
       "      <td>concur</td>\n",
       "      <td>39.21</td>\n",
       "      <td>843.93</td>\n",
       "      <td>other</td>\n",
       "      <td>other</td>\n",
       "      <td>positive</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>123180.0</td>\n",
       "      <td>950.0</td>\n",
       "      <td>843.93</td>\n",
       "      <td>American Express Global Business Travel</td>\n",
       "      <td>YOTEL New York City</td>\n",
       "      <td>hotel</td>\n",
       "      <td>13.0</td>\n",
       "      <td>2016-07-13 04:00:00</td>\n",
       "      <td>2016-07-10 04:00:00</td>\n",
       "      <td>942.0</td>\n",
       "      <td>...</td>\n",
       "      <td>Hotel</td>\n",
       "      <td>2016-07-10</td>\n",
       "      <td>YL</td>\n",
       "      <td>177</td>\n",
       "      <td>concur</td>\n",
       "      <td>242.10</td>\n",
       "      <td>843.93</td>\n",
       "      <td>other</td>\n",
       "      <td>other</td>\n",
       "      <td>positive</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>123180.0</td>\n",
       "      <td>950.0</td>\n",
       "      <td>843.93</td>\n",
       "      <td>American Express Global Business Travel</td>\n",
       "      <td>YOTEL New York City</td>\n",
       "      <td>hotel</td>\n",
       "      <td>13.0</td>\n",
       "      <td>2016-07-13 04:00:00</td>\n",
       "      <td>2016-07-10 04:00:00</td>\n",
       "      <td>942.0</td>\n",
       "      <td>...</td>\n",
       "      <td>Hotel Tax</td>\n",
       "      <td>2016-07-11</td>\n",
       "      <td>YL</td>\n",
       "      <td>177</td>\n",
       "      <td>concur</td>\n",
       "      <td>39.21</td>\n",
       "      <td>843.93</td>\n",
       "      <td>other</td>\n",
       "      <td>other</td>\n",
       "      <td>positive</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5 rows Ã— 22 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "   budget_id  budget_price  actual_cost  \\\n",
       "0   123180.0         950.0       843.93   \n",
       "1   123180.0         950.0       843.93   \n",
       "2   123180.0         950.0       843.93   \n",
       "3   123180.0         950.0       843.93   \n",
       "4   123180.0         950.0       843.93   \n",
       "\n",
       "                           purchase_vendor        travel_vendor budget_type  \\\n",
       "0  American Express Global Business Travel  YOTEL New York City       hotel   \n",
       "1  American Express Global Business Travel  YOTEL New York City       hotel   \n",
       "2  American Express Global Business Travel  YOTEL New York City       hotel   \n",
       "3  American Express Global Business Travel  YOTEL New York City       hotel   \n",
       "4  American Express Global Business Travel  YOTEL New York City       hotel   \n",
       "\n",
       "   budget_saver_scenario_id         end_datetime       start_datetime  \\\n",
       "0                      13.0  2016-07-13 04:00:00  2016-07-10 04:00:00   \n",
       "1                      13.0  2016-07-13 04:00:00  2016-07-10 04:00:00   \n",
       "2                      13.0  2016-07-13 04:00:00  2016-07-10 04:00:00   \n",
       "3                      13.0  2016-07-13 04:00:00  2016-07-10 04:00:00   \n",
       "4                      13.0  2016-07-13 04:00:00  2016-07-10 04:00:00   \n",
       "\n",
       "   budget_price_source    ...     expense_type_name_itemization  \\\n",
       "0                942.0    ...                             Hotel   \n",
       "1                942.0    ...                             Hotel   \n",
       "2                942.0    ...                         Hotel Tax   \n",
       "3                942.0    ...                             Hotel   \n",
       "4                942.0    ...                         Hotel Tax   \n",
       "\n",
       "  transaction_date_itemization vendor_name_expense organization_id_expense  \\\n",
       "0                   2016-07-12                  YL                     177   \n",
       "1                   2016-07-11                  YL                     177   \n",
       "2                   2016-07-12                  YL                     177   \n",
       "3                   2016-07-10                  YL                     177   \n",
       "4                   2016-07-11                  YL                     177   \n",
       "\n",
       "  expense_system_expense  expensed_amount_itemization expensed_amount_expense  \\\n",
       "0                 concur                       242.10                  843.93   \n",
       "1                 concur                       242.10                  843.93   \n",
       "2                 concur                        39.21                  843.93   \n",
       "3                 concur                       242.10                  843.93   \n",
       "4                 concur                        39.21                  843.93   \n",
       "\n",
       "   expense_category_itemization  expense_category_expense     label  \n",
       "0                         other                     other  positive  \n",
       "1                         other                     other  positive  \n",
       "2                         other                     other  positive  \n",
       "3                         other                     other  positive  \n",
       "4                         other                     other  positive  \n",
       "\n",
       "[5 rows x 22 columns]"
      ]
     },
     "execution_count": 3,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_feat_M_small = pd.DataFrame.from_csv('../data/feat_M_small.csv')\n",
    "df_feat_M_small[:5]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {
    "collapsed": false
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "budget_id\n",
      "budget_price\n",
      "actual_cost\n",
      "purchase_vendor\n",
      "travel_vendor\n",
      "budget_type\n",
      "budget_saver_scenario_id\n",
      "end_datetime\n",
      "start_datetime\n",
      "budget_price_source\n",
      "basis_fare\n",
      "expense_type_name_expense\n",
      "expense_type_name_itemization\n",
      "transaction_date_itemization\n",
      "vendor_name_expense\n",
      "organization_id_expense\n",
      "expense_system_expense\n",
      "expensed_amount_itemization\n",
      "expensed_amount_expense\n",
      "expense_category_itemization\n",
      "expense_category_expense\n",
      "label\n"
     ]
    }
   ],
   "source": [
    "print '\\n'.join(df_feat_M_small)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "metadata": {
    "collapsed": false,
    "scrolled": true
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0                             yl\n",
       "1                             yl\n",
       "2                             yl\n",
       "3                             yl\n",
       "4                             yl\n",
       "5                             yl\n",
       "522                 tryp wyndham\n",
       "523                 tryp wyndham\n",
       "524                 tryp wyndham\n",
       "525                 tryp wyndham\n",
       "526                 tryp wyndham\n",
       "527                 tryp wyndham\n",
       "528                 tryp wyndham\n",
       "529                 tryp wyndham\n",
       "530                 tryp wyndham\n",
       "19367                     amazon\n",
       "19368          huntsvill airport\n",
       "19369             cafe grind llc\n",
       "19370                 yellow cab\n",
       "19371                         yl\n",
       "19372                         yl\n",
       "19373                         yl\n",
       "19374                         yl\n",
       "19375           jenni marketplac\n",
       "19376               jenni market\n",
       "19377                 cafe grind\n",
       "19378                 yellow cab\n",
       "19379           quicktrip corpor\n",
       "19380          whole food market\n",
       "19382             delta air line\n",
       "                  ...           \n",
       "30603                    stubhub\n",
       "30604                    comcast\n",
       "30605                    verizon\n",
       "30606                    comcast\n",
       "30607                    verizon\n",
       "33703         landmark diner inc\n",
       "33705             starbuck coffe\n",
       "33706                   taco mac\n",
       "33707                red lobster\n",
       "35006               dunkin donut\n",
       "35007                hsv airport\n",
       "35008                       uber\n",
       "35009                      yotel\n",
       "35010                      yotel\n",
       "35011                      yotel\n",
       "35012                      yotel\n",
       "35013                      yotel\n",
       "35014                      yotel\n",
       "35015                      yotel\n",
       "35016                      yotel\n",
       "35017                       cafe\n",
       "35018               olli sichuan\n",
       "35019               dunkin donut\n",
       "35020    west side steakhous llc\n",
       "35021              lansdown road\n",
       "35022                    pio pio\n",
       "35023                 cafe grind\n",
       "35024                       uber\n",
       "35025                       cafe\n",
       "35026                  landstown\n",
       "Name: vendor_name_expense_normalized, dtype: object"
      ]
     },
     "execution_count": 9,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_feat_M_small['vendor_name_expense_normalized'] = df_feat_M_small['vendor_name_expense'].apply(normalize)\n",
    "df_feat_M_small['vendor_name_expense_normalized']"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 23,
   "metadata": {
    "collapsed": false
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "False    98\n",
       "True      2\n",
       "Name: vendor_name_expense, dtype: int64"
      ]
     },
     "execution_count": 23,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "def check_membership_if_in_stopwords(input_str):\n",
    "    '''\n",
    "    USE:\n",
    "    df_feat_M_small['vendor_name_expense'].apply(check_membership_if_in_stopwords)\n",
    "    '''\n",
    "    \n",
    "    for word in list(POST_NORMALIZATION_STOP_WORDS_FOR_VENDOR_NAME):\n",
    "        if word in normalize(input_str):\n",
    "            return True\n",
    "    return False\n",
    "\n",
    "df_feat_M_small['vendor_name_expense'].apply(check_membership_if_in_stopwords).value_counts()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 21,
   "metadata": {
    "collapsed": false,
    "scrolled": true
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "vendor_name_expense\r\n",
      "YL\r\n",
      "YL\r\n",
      "YL\r\n",
      "YL\r\n",
      "YL\r\n",
      "YL\r\n",
      "Tryp by Wyndham\r\n",
      "Tryp by Wyndham\r\n",
      "Tryp by Wyndham\r\n",
      "Tryp by Wyndham\r\n",
      "Tryp by Wyndham\r\n",
      "Tryp by Wyndham\r\n",
      "Tryp by Wyndham\r\n",
      "Tryp by Wyndham\r\n",
      "Tryp by Wyndham\r\n",
      "Amazon\r\n",
      "Huntsville Airport\r\n",
      "CAFE GRIND LLC THE\r\n",
      "Yellow Cab\r\n",
      "YL\r\n",
      "YL\r\n",
      "YL\r\n",
      "YL\r\n",
      "Jenny Marketplace\r\n",
      "Jenny Market\r\n",
      "THE CAFE GRIND\r\n",
      "Yellow Cab\r\n",
      "QUICKTRIP CORPORATION\r\n",
      "WHOLE FOODS MARKET\r\n",
      "Delta Air Lines\r\n",
      "Comcast\r\n",
      "Verizon\r\n",
      "Comcast\r\n",
      "Verizon\r\n",
      "subway\r\n",
      "Starbucks\r\n",
      "Embassy Suites\r\n",
      "Embassy Suites\r\n",
      "OUTBACK STEAKHOUSE\r\n",
      "Starbucks\r\n",
      "Yellow cab\r\n",
      "THE CAFE GRIND LLC\r\n",
      "Huntsville Airport\r\n",
      "MIDFIELD CONCESSIONS\r\n",
      "world duty shop\r\n",
      "Yotel\r\n",
      "Yotel\r\n",
      "Yotel\r\n",
      "Yotel\r\n",
      "Yotel\r\n",
      "Yotel\r\n",
      "Uber\r\n",
      "Uber\r\n",
      "THE CAFE GRIND\r\n",
      "Green Gourmet\r\n",
      "Delta Air Lines\r\n",
      "Huntsville Airport\r\n",
      "Friedmans\r\n",
      "Yellow Cab\r\n",
      "Uber\r\n",
      "Fig - Yotel\r\n",
      "THE CAFE GRIND\r\n",
      "PETER LUGER STEAK HOUSE\r\n",
      "Fig - Yotel\r\n",
      "37 St Deli Food Market\r\n",
      "Yellow Cab\r\n",
      "Delta Air Lines\r\n",
      "Delta Air Lines\r\n",
      "Stubhub\r\n",
      "StubHub\r\n",
      "Stubhub\r\n",
      "Comcast\r\n",
      "Verizon\r\n",
      "Comcast\r\n",
      "Verizon\r\n",
      "Landmark Diner Inc\r\n",
      "STARBUCKS COFFEE\r\n",
      "Taco Mac\r\n",
      "Red Lobster\r\n",
      "DUNKIN DONUT\r\n",
      "HSV airport\r\n",
      "Uber\r\n",
      "Yotel\r\n",
      "Yotel\r\n",
      "Yotel\r\n",
      "Yotel\r\n",
      "Yotel\r\n",
      "Yotel\r\n",
      "Yotel\r\n",
      "Yotel\r\n",
      "The Cafe\r\n",
      "ollies sichuan\r\n",
      "DUNKIN DONUT\r\n",
      "WEST SIDE STEAKHOUSE LLC\r\n",
      "Lansdowne Road\r\n",
      "Pio Pio\r\n",
      "THE CAFE GRIND\r\n",
      "Uber\r\n",
      "Cafe\r\n",
      "Landstowne\r\n"
     ]
    }
   ],
   "source": [
    "!cut -d, -f16 ../data/feat_M_small.csv "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": true
   },
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "anaconda-cloud": {},
  "kernelspec": {
   "display_name": "Python [Root]",
   "language": "python",
   "name": "Python [Root]"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 2
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython2",
   "version": "2.7.12"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 0
}
